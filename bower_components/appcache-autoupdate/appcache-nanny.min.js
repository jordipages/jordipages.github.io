// appCacheNanny
// =============
//
// Teaches your applicationCache some manners! Because, you know,
// http://alistapart.com/article/application-cache-is-a-douchebag
//
"use strict";!function(e,t){function n(){var e={},t=this;t.on=function(t,n,r){e[t]||(e[t]=[]),e[t].push({f:n,c:r})},t.off=function(t,n){for(var r=e[t]||[],a=r.length=n?r.length:0;a-->0;)n===r[a].f&&r.splice(a,1)},t.trigger=function(){var t,n=Array.apply([],arguments),r=e[n.shift()]||[],a=r.length;for(t=0;a>t;t++)r[t].f.apply(r[t].c,n)},t.bind=t.on,t.unbind=t.off,t.emit=t.trigger}var r="undefined"==typeof applicationCache?void 0:applicationCache;"function"==typeof define&&define.amd?define([],function(){return e.appCacheNanny=t(r,n),e.appCacheNanny}):"object"==typeof exports?module.exports=t(r,n):e.appCacheNanny=t(r,n)}(this,function(e,t){function n(){var t,n;try{I=!localStorage.getItem(b),localStorage.setItem(b,"1")}catch(a){}return s.isSupported()?e.status!==e.UNCACHED?(r(),y=!1,v=!0,void N.forEach(function(e){e()})):(t=document.createElement("iframe"),t.src=l.loaderPath,t.style.display="none",t.onload=function(){e=t.contentWindow.applicationCache,r(),y=!1,v=!0,N.forEach(function(e){e()})},t.onerror=function(){throw new Error("/appcache-loader.html could not be loaded.")},n=document.getElementsByTagName("script")[0],void n.parentNode.insertBefore(t,n)):void(s.update=w)}function r(){a("updateready",i),a("error",u),a("obsolete",f),a("noupdate",c),a("cached",c),a("updateready",c),a("progress",c),a("downloading",c),addEventListener("online",s.update,!1),addEventListener("offline",s.update,!1)}function a(t,n){e.addEventListener(t,n,!1)}function o(e){m||s.trigger(e)}function i(){try{m||(m=!0,s.trigger("updateready")),e.swapCache()}catch(t){}}function c(e){var t="";I&&(t="init:","cached"===e.type&&(I=!1)),o(t+e.type),E&&(E=!1,s.start(),o("online"))}function u(){o("error"),E||(E=!0,e.status!==e.UNCACHED&&(s.start(),o("offline")))}function f(){o("obsolete"),E&&(E=!1,o("online")),s.stop()}var p="/appcache-loader.html",d=3e4,s=new t,l={loaderPath:p,checkInterval:d,offlineCheckInterval:d};s.isSupported=function(){return!!e},s.update=function(){if(o("update"),!v)return N.push(s.update),y||(n(),y=!0),!0;if(!s.isSupported())return!1;try{return e.update(),!0}catch(t){return s.update=w,!1}};var h,v=!1,y=!1;s.start=function(e){return e&&s.set(e),v?(clearInterval(h),g=s.get(E?"offlineCheckInterval":"checkInterval"),h=setInterval(s.update,g),C=!0,void o("start")):(N.push(s.start),y||(n(),y=!0),!0)},s.stop=function(){clearInterval(h),C=!1,o("stop")},s.isCheckingForUpdates=function(){return C},s.hasUpdate=function(){return m},s.set=function(e,t){var n,r;if("object"!=typeof e)l[e]=t;else{r=e;for(n in r)r.hasOwnProperty(n)&&(l[n]=r[n])}},s.get=function(e){var t,n={};if(e)return l[e];for(t in l)l.hasOwnProperty(t)&&(n[t]=l[t]);return n};var g=d,m=!1,C=!1,E=!1,I=!1,w=function(){},b="_appcache_nanny",N=[];return s});